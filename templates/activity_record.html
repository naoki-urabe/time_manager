{% load static %}
<!DOCTYPE html>
<html>
    <head>
        <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
        <script type="text/javascript">
        google.charts.load('current', {'packages':['timeline']});
        google.charts.setOnLoadCallback(drawChart);
        function drawChart() {
            var container = document.getElementById('timeline');
            var chart = new google.visualization.Timeline(container);
            var dataTable = new google.visualization.DataTable();

            dataTable.addColumn({ type: 'string', id: 'President' });
            dataTable.addColumn({ type: 'date', id: 'Start' });
            dataTable.addColumn({ type: 'date', id: 'End' });
           
            dataTable.addRows([  
            {% for task_history in task_histories %}        
            ["{{task_history.task}}",new Date("{{ task_history.begin_time.isoformat }}"), new Date("{{ task_history.end_time.isoformat }}")],          
            {% endfor %}       
            ]);
            chart.draw(dataTable);
        }
        </script>
    </head>
    <body>
        <div id="timeline" style="height: 180px;"></div>
        <p id="Clock"></p>
        <form action = "{% url 'register_active_record' %}" method="post" name="activity">
            {% csrf_token %}
            <input type="hidden" id="active_exists" name="active_exists" value={{ active_exists }}>
            <input type="hidden" id="task_id" name="task_id" value={{ active_id }}>
            <button type="button" id="punch" name="punch">{{ active_status }}</button>
        </form>
        <form action = "{% url 'register_task_record' %}" method="post" name="task">
            {% csrf_token %}
            <input type="hidden" id="task_exists" name="task_exists" value={{ task_exists }}>
            <input type="hidden" id="task_id" name="task_id" value={{ task_id }}>
            <input type="text" id="task_name" name="task_name" value={{ task_name }}>
            <button type="button" id="punch2" name="punch2">{{ task_status }}</button>
        </form>
        
        <table border="1">
            <tr>
                <th>タスク名</th>
                <th>開始時間</th>
                <th>終了時間</th>
                <th>活動時間</th>
            </tr>
            {% for activity in today_activity %}
            <tr>
            <td>{{activity.task}}</td>
            <td>{{activity.begin_time|date:"H:i:s T"}}</td>
            <td>{{activity.end_time|date:"H:i:s T"}}</td>
            <td>{{activity.period}}</td>
            {% endfor %}
            </tr>
            {% for task_history in task_histories %}
            <tr>
            <td>{{task_history.task}}</td>
            <td>{{task_history.begin_time|date:"H:i:s T"}}</td>
            <td>{{task_history.end_time|date:"H:i:s T"}}</td>
            <td>{{task_history.period}}</td>
            {% endfor %}
            </tr>
        </table>

    </body>
    <script src="{% static 'js/getNow.js' %}"></script>
    <script>
        setInterval(getNow,1000);
        //console.log(getNow)
        document.getElementById("punch").onclick = function() {      
            //document.getElementById("active_status").value = '{{ active_status }}'
            document.activity.submit()
        }
        document.getElementById("punch2").onclick = function() {      
            //document.getElementById("active_status").value = '{{ active_status }}'
            document.task.submit()
        }
    </script>
</html>

